<?php

namespace App\Service;

use App\Enum\SkillEnum;

class XpBoundaryService
{
    /**
     * @var array<int, array{start: int, end: int}>
     */
    private const array XP_TABLE = [
        1 => ['start' => 0, 'end' => 83],
        2 => ['start' => 83, 'end' => 174],
        3 => ['start' => 174, 'end' => 276],
        4 => ['start' => 276, 'end' => 388],
        5 => ['start' => 388, 'end' => 512],
        6 => ['start' => 512, 'end' => 650],
        7 => ['start' => 650, 'end' => 801],
        8 => ['start' => 801, 'end' => 969],
        9 => ['start' => 969, 'end' => 1154],
        10 => ['start' => 1154, 'end' => 1358],
        11 => ['start' => 1358, 'end' => 1584],
        12 => ['start' => 1584, 'end' => 1833],
        13 => ['start' => 1833, 'end' => 2107],
        14 => ['start' => 2107, 'end' => 2411],
        15 => ['start' => 2411, 'end' => 2746],
        16 => ['start' => 2746, 'end' => 3115],
        17 => ['start' => 3115, 'end' => 3523],
        18 => ['start' => 3523, 'end' => 3973],
        19 => ['start' => 3973, 'end' => 4470],
        20 => ['start' => 4470, 'end' => 5018],
        21 => ['start' => 5018, 'end' => 5624],
        22 => ['start' => 5624, 'end' => 6291],
        23 => ['start' => 6291, 'end' => 7028],
        24 => ['start' => 7028, 'end' => 7842],
        25 => ['start' => 7842, 'end' => 8740],
        26 => ['start' => 8740, 'end' => 9730],
        27 => ['start' => 9730, 'end' => 10824],
        28 => ['start' => 10824, 'end' => 12031],
        29 => ['start' => 12031, 'end' => 13363],
        30 => ['start' => 13363, 'end' => 14833],
        31 => ['start' => 14833, 'end' => 16456],
        32 => ['start' => 16456, 'end' => 18247],
        33 => ['start' => 18247, 'end' => 20224],
        34 => ['start' => 20224, 'end' => 22406],
        35 => ['start' => 22406, 'end' => 24815],
        36 => ['start' => 24815, 'end' => 27473],
        37 => ['start' => 27473, 'end' => 30408],
        38 => ['start' => 30408, 'end' => 33648],
        39 => ['start' => 33648, 'end' => 37224],
        40 => ['start' => 37224, 'end' => 41171],
        41 => ['start' => 41171, 'end' => 45529],
        42 => ['start' => 45529, 'end' => 50339],
        43 => ['start' => 50339, 'end' => 55649],
        44 => ['start' => 55649, 'end' => 61512],
        45 => ['start' => 61512, 'end' => 67983],
        46 => ['start' => 67983, 'end' => 75127],
        47 => ['start' => 75127, 'end' => 83014],
        48 => ['start' => 83014, 'end' => 91721],
        49 => ['start' => 91721, 'end' => 101333],
        50 => ['start' => 101333, 'end' => 111945],
        51 => ['start' => 111945, 'end' => 123660],
        52 => ['start' => 123660, 'end' => 136594],
        53 => ['start' => 136594, 'end' => 150872],
        54 => ['start' => 150872, 'end' => 166636],
        55 => ['start' => 166636, 'end' => 184040],
        56 => ['start' => 184040, 'end' => 203254],
        57 => ['start' => 203254, 'end' => 224466],
        58 => ['start' => 224466, 'end' => 247886],
        59 => ['start' => 247886, 'end' => 273742],
        60 => ['start' => 273742, 'end' => 302288],
        61 => ['start' => 302288, 'end' => 333804],
        62 => ['start' => 333804, 'end' => 368599],
        63 => ['start' => 368599, 'end' => 407015],
        64 => ['start' => 407015, 'end' => 449428],
        65 => ['start' => 449428, 'end' => 496254],
        66 => ['start' => 496254, 'end' => 547953],
        67 => ['start' => 547953, 'end' => 605032],
        68 => ['start' => 605032, 'end' => 668051],
        69 => ['start' => 668051, 'end' => 737627],
        70 => ['start' => 737627, 'end' => 814445],
        71 => ['start' => 814445, 'end' => 899257],
        72 => ['start' => 899257, 'end' => 992895],
        73 => ['start' => 992895, 'end' => 1096278],
        74 => ['start' => 1096278, 'end' => 1210421],
        75 => ['start' => 1210421, 'end' => 1336443],
        76 => ['start' => 1336443, 'end' => 1475581],
        77 => ['start' => 1475581, 'end' => 1629200],
        78 => ['start' => 1629200, 'end' => 1798808],
        79 => ['start' => 1798808, 'end' => 1986068],
        80 => ['start' => 1986068, 'end' => 2192818],
        81 => ['start' => 2192818, 'end' => 2421087],
        82 => ['start' => 2421087, 'end' => 2673114],
        83 => ['start' => 2673114, 'end' => 2951373],
        84 => ['start' => 2951373, 'end' => 3258594],
        85 => ['start' => 3258594, 'end' => 3597792],
        86 => ['start' => 3597792, 'end' => 3972294],
        87 => ['start' => 3972294, 'end' => 4385776],
        88 => ['start' => 4385776, 'end' => 4842295],
        89 => ['start' => 4842295, 'end' => 5346332],
        90 => ['start' => 5346332, 'end' => 5902831],
        91 => ['start' => 5902831, 'end' => 6517253],
        92 => ['start' => 6517253, 'end' => 7195629],
        93 => ['start' => 7195629, 'end' => 7944614],
        94 => ['start' => 7944614, 'end' => 8771558],
        95 => ['start' => 8771558, 'end' => 9684577],
        96 => ['start' => 9684577, 'end' => 10692629],
        97 => ['start' => 10692629, 'end' => 11805606],
        98 => ['start' => 11805606, 'end' => 13034431],
        99 => ['start' => 13034431, 'end' => 14391160],
        100 => ['start' => 14391160, 'end' => 15889109],
        101 => ['start' => 15889109, 'end' => 17542976],
        102 => ['start' => 17542976, 'end' => 19368992],
        103 => ['start' => 19368992, 'end' => 21385073],
        104 => ['start' => 21385073, 'end' => 23611006],
        105 => ['start' => 23611006, 'end' => 26068632],
        106 => ['start' => 26068632, 'end' => 28782069],
        107 => ['start' => 28782069, 'end' => 31777943],
        108 => ['start' => 31777943, 'end' => 35085654],
        109 => ['start' => 35085654, 'end' => 38737661],
        110 => ['start' => 38737661, 'end' => 42769801],
        111 => ['start' => 42769801, 'end' => 47221641],
        112 => ['start' => 47221641, 'end' => 52136869],
        113 => ['start' => 52136869, 'end' => 57563718],
        114 => ['start' => 57563718, 'end' => 63555443],
        115 => ['start' => 63555443, 'end' => 70170840],
        116 => ['start' => 70170840, 'end' => 77474828],
        117 => ['start' => 77474828, 'end' => 85539082],
        118 => ['start' => 85539082, 'end' => 94442737],
        119 => ['start' => 94442737, 'end' => 104273167],
        120 => ['start' => 104273167, 'end' => 115126838],
        121 => ['start' => 115126838, 'end' => 127110260],
        122 => ['start' => 127110260, 'end' => 140341028],
        123 => ['start' => 140341028, 'end' => 154948977],
        124 => ['start' => 154948977, 'end' => 171077457],
        125 => ['start' => 171077457, 'end' => 188884740],
        126 => ['start' => 188884740, 'end' => 200000001]
    ];

    /**
     * @var array<int, array{start: int, end: int}>
     */
    private const array ELITE_XP_TABLE = [
        1 => ['start' => 0, 'end' => 830],
        2 => ['start' => 830, 'end' => 1861],
        3 => ['start' => 1861, 'end' => 2902],
        4 => ['start' => 2902, 'end' => 3980],
        5 => ['start' => 3980, 'end' => 5126],
        6 => ['start' => 5126, 'end' => 6390],
        7 => ['start' => 6390, 'end' => 7787],
        8 => ['start' => 7787, 'end' => 9400],
        9 => ['start' => 9400, 'end' => 11275],
        10 => ['start' => 11275, 'end' => 13505],
        11 => ['start' => 13505, 'end' => 16222],
        12 => ['start' => 16222, 'end' => 19356],
        13 => ['start' => 19356, 'end' => 23146],
        14 => ['start' => 23146, 'end' => 27787],
        15 => ['start' => 27787, 'end' => 33487],
        16 => ['start' => 33487, 'end' => 40257],
        17 => ['start' => 40257, 'end' => 48502],
        18 => ['start' => 48502, 'end' => 57109],
        19 => ['start' => 57109, 'end' => 65535],
        20 => ['start' => 65535, 'end' => 74802],
        21 => ['start' => 74802, 'end' => 87190],
        22 => ['start' => 87190, 'end' => 90811],
        23 => ['start' => 90811, 'end' => 106221],
        24 => ['start' => 106221, 'end' => 123573],
        25 => ['start' => 123573, 'end' => 143025],
        26 => ['start' => 143025, 'end' => 164742],
        27 => ['start' => 164742, 'end' => 188893],
        28 => ['start' => 188893, 'end' => 215651],
        29 => ['start' => 215651, 'end' => 245196],
        30 => ['start' => 245196, 'end' => 277713],
        31 => ['start' => 316311, 'end' => 358547],
        32 => ['start' => 358547, 'end' => 404634],
        33 => ['start' => 404634, 'end' => 454796],
        34 => ['start' => 454796, 'end' => 509259],
        35 => ['start' => 509259, 'end' => 568254],
        36 => ['start' => 568254, 'end' => 632019],
        37 => ['start' => 632019, 'end' => 700797],
        38 => ['start' => 700797, 'end' => 774834],
        39 => ['start' => 774834, 'end' => 854383],
        40 => ['start' => 854383, 'end' => 946227],
        41 => ['start' => 946227, 'end' => 1044569],
        42 => ['start' => 1044569, 'end' => 1149696],
        43 => ['start' => 1149696, 'end' => 1261903],
        44 => ['start' => 1261903, 'end' => 1381488],
        45 => ['start' => 1381488, 'end' => 1508756],
        46 => ['start' => 1508756, 'end' => 1644015],
        47 => ['start' => 1644015, 'end' => 1787581],
        48 => ['start' => 1787581, 'end' => 1939773],
        49 => ['start' => 1939773, 'end' => 2100917],
        50 => ['start' => 2100917, 'end' => 2283490],
        51 => ['start' => 2283490, 'end' => 2476369],
        52 => ['start' => 2476369, 'end' => 2679907],
        53 => ['start' => 2679907, 'end' => 2894505],
        54 => ['start' => 2894505, 'end' => 3118508],
        55 => ['start' => 3118508, 'end' => 3358307],
        56 => ['start' => 3358307, 'end' => 3608290],
        57 => ['start' => 3608290, 'end' => 3870846],
        58 => ['start' => 3870846, 'end' => 4146374],
        59 => ['start' => 4146374, 'end' => 4435275],
        60 => ['start' => 4435275, 'end' => 4743575],
        61 => ['start' => 4758122, 'end' => 5096111],
        62 => ['start' => 5096111, 'end' => 5449685],
        63 => ['start' => 5449685, 'end' => 5819299],
        64 => ['start' => 5819299, 'end' => 6205407],
        65 => ['start' => 6205407, 'end' => 6608473],
        66 => ['start' => 6608473, 'end' => 7028964],
        67 => ['start' => 7028964, 'end' => 7467354],
        68 => ['start' => 7467354, 'end' => 7924122],
        69 => ['start' => 7924122, 'end' => 8399751],
        70 => ['start' => 8399751, 'end' => 8925664],
        71 => ['start' => 8925664, 'end' => 9472665],
        72 => ['start' => 9472665, 'end' => 10041285],
        73 => ['start' => 10041285, 'end' => 10632061],
        74 => ['start' => 10632061, 'end' => 11245538],
        75 => ['start' => 11245538, 'end' => 11882262],
        76 => ['start' => 11882262, 'end' => 12542789],
        77 => ['start' => 12542789, 'end' => 13227679],
        78 => ['start' => 13227679, 'end' => 13937496],
        79 => ['start' => 13937496, 'end' => 14672812],
        80 => ['start' => 14672812, 'end' => 15478994],
        81 => ['start' => 15478994, 'end' => 16313404],
        82 => ['start' => 16313404, 'end' => 17176661],
        83 => ['start' => 17176661, 'end' => 18069395],
        84 => ['start' => 18069395, 'end' => 18992239],
        85 => ['start' => 18992239, 'end' => 19945833],
        86 => ['start' => 19945833, 'end' => 20930821],
        87 => ['start' => 20930821, 'end' => 21947856],
        88 => ['start' => 21947856, 'end' => 22997593],
        89 => ['start' => 22997593, 'end' => 24080695],
        90 => ['start' => 24080695, 'end' => 25199999],
        91 => ['start' => 25259906, 'end' => 26475754],
        92 => ['start' => 26475754, 'end' => 27728955],
        93 => ['start' => 27728955, 'end' => 29020233],
        94 => ['start' => 29020233, 'end' => 30350318],
        95 => ['start' => 30350318, 'end' => 31719944],
        96 => ['start' => 31719944, 'end' => 33129852],
        97 => ['start' => 33129852, 'end' => 34580790],
        98 => ['start' => 34580790, 'end' => 36073511],
        99 => ['start' => 36073511, 'end' => 37608773],
        100 => ['start' => 37608773, 'end' => 39270442],
        101 => ['start' => 39270442, 'end' => 40978509],
        102 => ['start' => 40978509, 'end' => 42733789],
        103 => ['start' => 42733789, 'end' => 44537107],
        104 => ['start' => 44537107, 'end' => 46389292],
        105 => ['start' => 46389292, 'end' => 48391180],
        106 => ['start' => 48391180, 'end' => 50243611],
        107 => ['start' => 50243611, 'end' => 52247435],
        108 => ['start' => 52247435, 'end' => 54303504],
        109 => ['start' => 54303504, 'end' => 56312678],
        110 => ['start' => 56312678, 'end' => 58575823],
        111 => ['start' => 58575823, 'end' => 60793812],
        112 => ['start' => 60793812, 'end' => 63067521],
        113 => ['start' => 63067521, 'end' => 65397835],
        114 => ['start' => 65397835, 'end' => 67785643],
        115 => ['start' => 67785643, 'end' => 70231841],
        116 => ['start' => 70231841, 'end' => 72737330],
        117 => ['start' => 72737330, 'end' => 75303019],
        118 => ['start' => 75303019, 'end' => 77929820],
        119 => ['start' => 77929820, 'end' => 80618654],
        120 => ['start' => 80618654, 'end' => 83368743],
        121 => ['start' => 83370445, 'end' => 86186124],
        122 => ['start' => 86186124, 'end' => 89066630],
        123 => ['start' => 89066630, 'end' => 92012904],
        124 => ['start' => 92012904, 'end' => 95025896],
        125 => ['start' => 95025896, 'end' => 980106559],
        126 => ['start' => 980106559, 'end' => 101255855],
        127 => ['start' => 101255855, 'end' => 104474750],
        128 => ['start' => 104474750, 'end' => 107764216],
        129 => ['start' => 107764216, 'end' => 111125230],
        130 => ['start' => 111125230, 'end' => 114558777],
        131 => ['start' => 114558777, 'end' => 118065845],
        132 => ['start' => 118065845, 'end' => 121647430],
        133 => ['start' => 121647430, 'end' => 125304532],
        134 => ['start' => 125304532, 'end' => 129038159],
        135 => ['start' => 129038159, 'end' => 132849323],
        136 => ['start' => 132849323, 'end' => 136739041],
        137 => ['start' => 136739041, 'end' => 140708338],
        138 => ['start' => 140708338, 'end' => 144758242],
        139 => ['start' => 144758242, 'end' => 148889790],
        140 => ['start' => 148889790, 'end' => 153104021],
        141 => ['start' => 153104021, 'end' => 157401983],
        142 => ['start' => 157401983, 'end' => 161784728],
        143 => ['start' => 161784728, 'end' => 166253312],
        144 => ['start' => 166253312, 'end' => 170808801],
        145 => ['start' => 170808801, 'end' => 175452262],
        146 => ['start' => 175452262, 'end' => 180184770],
        147 => ['start' => 180184770, 'end' => 185007406],
        148 => ['start' => 185007406, 'end' => 189921255],
        149 => ['start' => 189921255, 'end' => 194927409],
        150 => ['start' => 194927409, 'end' => 200000001]
    ];

    public function isXpWithinLevelBoundaries(SkillEnum $skill, int $level, float $xp): bool
    {
        $xpTable = $skill->isElite() ? self::ELITE_XP_TABLE : self::XP_TABLE;
        $boundaries = $xpTable[$level];

        return $xp >= $boundaries['start'] && $xp < $boundaries['end'];
    }
}
